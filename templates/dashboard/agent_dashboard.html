{% extends "base.html" %}

{% block title %}Agent Dashboard - Financial Planning System{% endblock %}

{% block content %}
<div class="page-header d-print-none">
    <div class="container-xl">
        <div class="row g-2 align-items-center">
            <div class="col">
                <h2 class="page-title">
                    Agent Dashboard
                </h2>
                <div class="text-muted mt-1">Welcome back, {{ current_user.full_name or current_user.username }}</div>
            </div>
        </div>
    </div>
</div>

<div class="page-body">
    <div class="container-xl">
        <!-- Plan Details Card -->
        {% if current_user.plan_id %}
        <div class="row row-cards">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">My Plan Details</h3>
                    </div>
                    <div class="card-body">
                        <div class="datagrid">
                            <div class="datagrid-item">
                                <div class="datagrid-title">Plan Status</div>
                                <div class="datagrid-content">
                                    {% if current_user.plan_expiry_date %}
                                        {% set now = datetime.utcnow() %}
                                        {% if current_user.plan_expiry_date > now %}
                                            <span class="badge bg-success">Active</span>
                                        {% else %}
                                            <span class="badge bg-danger">Expired</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="badge bg-warning">No Expiry Set</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="datagrid-item">
                                <div class="datagrid-title">Plan Expiry</div>
                                <div class="datagrid-content">
                                    {{ current_user.plan_expiry_date.strftime('%Y-%m-%d') if current_user.plan_expiry_date else 'N/A' }}
                                </div>
                            </div>
                            <div class="datagrid-item">
                                <div class="datagrid-title">PDF Usage</div>
                                <div class="datagrid-content">
                                    {{ current_user.agent_pdf_generated }} / {{ current_user.agent_pdf_limit }}
                                    <div class="progress progress-sm">
                                        <div class="progress-bar bg-primary" style="width: {{ (current_user.agent_pdf_generated / current_user.agent_pdf_limit * 100) if current_user.agent_pdf_limit > 0 else 0 }}%" role="progressbar"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="datagrid-item">
                                <div class="datagrid-title">PDFs Remaining</div>
                                <div class="datagrid-content">
                                    {{ current_user.agent_pdf_limit - current_user.agent_pdf_generated }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="row">
            <div class="col-12">
                <div class="alert alert-warning" role="alert">
                    <h4 class="alert-title">No Plan Assigned</h4>
                    <div class="text-muted">You don't have any plan assigned yet. Please contact your administrator.</div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Quick Actions -->
        <div class="row row-cards mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Quick Actions</h3>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-auto">
                                <a href="{{ url_for('users.profile') }}" class="btn btn-primary">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" /><path d="M12 10m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /><path d="M6.168 18.849a4 4 0 0 1 3.832 -2.849h4a4 4 0 0 1 3.834 2.855" /></svg>
                                    My Profile
                                </a>
                            </div>
                            {% if current_user.plan_id %}
                            <div class="col-auto">
                                <a href="{{ url_for('health_insurance.index') }}" class="btn btn-success">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2" /><path d="M9 3m0 2a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v0a2 2 0 0 1 -2 2h-2a2 2 0 0 1 -2 -2z" /></svg>
                                    Health Insurance Forms
                                </a>
                            </div>
                            {% endif %}
                            <div class="col-auto">
                                <a href="{{ url_for('auth.change_password') }}" class="btn btn-info">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 13a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-6z" /><path d="M11 16a1 1 0 1 0 2 0a1 1 0 0 0 -2 0" /><path d="M8 11v-4a4 4 0 1 1 8 0v4" /></svg>
                                    Change Password
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// You can add any agent-specific JavaScript here
</script>
{% endblock %}